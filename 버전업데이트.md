# SpatialCheckPro2 NuGet 패키지 업데이트 가이드

**모든 패키지가 .NET 9.0과 호환되며**, 특히 GDAL은 3.12.0으로 주요 업데이트가 있고, gRPC 패키지군은 2.71.0+으로 대폭 업그레이드되었습니다. Microsoft.Extensions.Http는 현재 8.0.0에서 9.0.4로 업데이트가 필요하며, iTextSharp.LGPLv2.Core는 SkiaSharp 의존성으로 변경되어 마이그레이션 주의가 필요합니다.

---

## 전체 패키지 버전 비교표

| 카테고리 | 패키지명 | 현재 버전 | 최신 버전 | 업데이트 필요 |
|---------|---------|----------|----------|-------------|
| **GIS** | MaxRev.Gdal.Core | 3.10.3 | **3.12.0.423** | ✅ 예 |
| | MaxRev.Gdal.LinuxRuntime.Minimal | 3.10.3 | **3.12.0.397** | ✅ 예 |
| | NetTopologySuite | 2.6.0 | 2.6.0 | ❌ 최신 |
| | NetTopologySuite.IO.GeoJSON | 4.0.0 | 4.0.0 | ❌ 최신 |
| **DB** | Microsoft.EntityFrameworkCore.Sqlite | 9.0.9 | **9.0.10** | ✅ 예 |
| | Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite | 9.0.9 | **9.0.10** | ✅ 예 |
| **DI/Hosting** | Microsoft.Extensions.DependencyInjection | 9.0.9 | **9.0.10** | ✅ 예 |
| | Microsoft.Extensions.Hosting | 9.0.9 | **9.0.10** | ✅ 예 |
| | Microsoft.Extensions.Logging | 9.0.9 | **9.0.10** | ✅ 예 |
| | Microsoft.Extensions.Logging.Console | 9.0.9 | 9.0.9 | ❌ 최신 |
| | Microsoft.Extensions.Http | 8.0.0 | **9.0.4** | ⚠️ 메이저 |
| **Logging** | Serilog | 4.2.0 | **4.3.0** | ✅ 예 |
| | Serilog.Extensions.Logging | 8.0.0 | **9.0.0** | ✅ 예 |
| **WPF/UI** | CommunityToolkit.Mvvm | 8.4.0 | 8.4.0 | ❌ 최신 |
| | Microsoft.Xaml.Behaviors.Wpf | 1.1.122 | **1.1.135** | ✅ 예 |
| | Microsoft.VisualBasic | 10.3.0 | 10.3.0 | ❌ 최신 |
| **PDF/CSV** | iTextSharp.LGPLv2.Core | 3.4.21 | **3.7.12** | ⚠️ 주의 |
| | PDFsharp-MigraDoc | 6.2.1 | **6.2.3** | ✅ 예 |
| | CsvHelper | 33.1.0 | 33.1.0 | ❌ 최신 |
| **gRPC** | Grpc.Net.Client | 2.57.0 | **2.71.0** | ⚠️ 메이저 |
| | Google.Protobuf | 3.25.1 | **3.33.1** | ⚠️ 메이저 |
| | Grpc.Tools | 2.57.0 | **2.72.0** | ⚠️ 메이저 |
| **Test** | xunit | 2.9.2 | **2.9.3** | ✅ 예 |
| | xunit.runner.visualstudio | 2.8.2 | **3.1.5** | ⚠️ 메이저 |
| | Microsoft.NET.Test.Sdk | 17.12.0 | **17.14.1** | ✅ 예 |
| | Moq | 4.20.72 | 4.20.72 | ❌ 최신 |
| | coverlet.collector | 6.0.2 | **6.0.4** | ✅ 예 |

---

## .NET 9.0 호환성 매트릭스

모든 패키지가 .NET 9.0을 지원합니다. 대부분 **.NET Standard 2.0** 타겟팅을 통해 호환되며, 일부 Microsoft 패키지는 .NET 8.0+ 타겟으로 .NET 9.0에서 원활하게 작동합니다.

| 호환 방식 | 패키지 예시 | 비고 |
|----------|-----------|------|
| **명시적 net9.0 타겟** | iTextSharp.LGPLv2.Core, PDFsharp-MigraDoc | 최적화된 빌드 제공 |
| **.NET 8.0+ 타겟** | EF Core 9.x, Microsoft.Extensions 9.x | .NET 8/9 모두 지원 |
| **.NET Standard 2.0** | NetTopologySuite, GDAL, Serilog, CsvHelper | 폭넓은 호환성 |

---

## GIS 패키지 심층 분석과 상호 운용성

### GDAL 3.12.0 업그레이드 주요 변경사항

MaxRev.Gdal.Core **3.12.0.423**은 GDAL 3.12.0, PROJ 9.7.0, GEOS 3.13.0을 포함하며, 내부 라이브러리가 전면 업그레이드되었습니다. Arrow 및 Parquet 드라이버가 3.11.5부터 추가되어 현대적인 데이터 포맷 지원이 강화되었습니다.

**플랫폼별 런타임 패키지 선택:**
- Windows: `MaxRev.Gdal.WindowsRuntime.Minimal`
- Linux: `MaxRev.Gdal.LinuxRuntime.Minimal` (x64/arm64)
- macOS: `MaxRev.Gdal.MacosRuntime.Minimal`
- 통합: `MaxRev.Gdal.Universal` (모든 플랫폼 번들)

### GDAL ↔ NetTopologySuite 상호 운용성

두 라이브러리는 **독립적인 지오메트리 모델**을 사용하므로 직접적인 타입 호환성은 없습니다. GDAL은 `OSGeo.OGR.Geometry`를, NetTopologySuite는 `NetTopologySuite.Geometries.Geometry`를 사용합니다.

**권장 변환 워크플로우:**
```csharp
// GDAL → NTS 변환
var ogrGeometry = feature.GetGeometryRef();
string wkt = ogrGeometry.ExportToWkt(out string wktResult);
var ntsGeometry = new WKTReader().Read(wktResult);

// NTS → GDAL 변환  
string wkt = new WKTWriter().Write(ntsGeometry);
var ogrGeometry = OSGeo.OGR.Geometry.CreateFromWkt(wkt);
```

좌표계 변환 시 GDAL은 PROJ를, NetTopologySuite는 ProjNet을 사용하므로 미세한 정밀도 차이가 발생할 수 있습니다.

### EF Core Spatial과 NetTopologySuite 호환성

`Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite` **9.0.10**은 NetTopologySuite **≥2.5.0**을 요구하며, 현재 사용 중인 2.6.0과 완벽 호환됩니다. 추가로 `NetTopologySuite.IO.SpatiaLite ≥2.0.0`과 `mod_spatialite ≥4.3.0.1`에 의존합니다.

---

## Microsoft.Extensions.Http 버전 격차 해소

현재 **8.0.0**에서 **9.0.4**로 업그레이드하면 다른 9.x 패키지들과 버전이 일치하게 됩니다. 9.x 버전은 .NET 8.0+ 타겟으로 .NET 9.0에서 최적화된 성능을 제공합니다.

---

## PDF 라이브러리 마이그레이션 주의사항

### iTextSharp.LGPLv2.Core의 SkiaSharp 전환

**3.7.12** 버전부터 `System.Drawing.Common` 대신 **SkiaSharp**를 사용합니다. 이는 크로스 플랫폼 호환성을 크게 개선하지만 다음 추가 패키지가 필요합니다:

- `SkiaSharp ≥3.119.1` (자동 의존성)
- `BouncyCastle.Cryptography ≥2.6.2` (자동 의존성)
- Linux 배포 시: `SkiaSharp.NativeAssets.Linux.NoDependencies`, `HarfBuzzSharp.NativeAssets.Linux`

### WPF 전용 PDF 생성 시 권장 패키지

WPF 애플리케이션에서는 `PDFsharp-MigraDoc-WPF` **6.2.3** 사용을 권장합니다. WPF 렌더링 엔진을 활용하여 Windows 환경에서 더 나은 폰트 처리를 제공합니다.

---

## gRPC 패키지 대규모 업데이트

2.57.0에서 2.71.0+으로의 업그레이드는 **14개 마이너 버전** 차이가 있지만, API 호환성이 유지됩니다. 세 패키지를 함께 업데이트하는 것이 중요합니다:

| 패키지 | 권장 버전 | 비고 |
|--------|----------|------|
| Grpc.Net.Client | 2.71.0 | 메인 클라이언트 |
| Google.Protobuf | 3.33.1 | 직렬화 라이브러리 |
| Grpc.Tools | 2.72.0 | 빌드 도구 |

`Grpc.Core` (레거시 네이티브 구현)는 유지보수 모드이며 향후 deprecated 예정입니다. `Grpc.Net.Client`가 모던 .NET의 권장 구현체입니다.

---

## 테스트 패키지와 Moq 보안 이슈

### Moq SponsorLink 논란 (2023년 8월)

버전 4.20.0~4.20.1에서 **SponsorLink**가 포함되어 빌드 시 개발자 이메일을 수집하는 문제가 발생했습니다. **4.20.2부터 제거**되었으며, 현재 4.20.72는 안전합니다. 그러나 일부 조직에서는 NSubstitute나 FakeItEasy로 마이그레이션했습니다.

### xUnit v3 마이그레이션 고려

xunit.runner.visualstudio **3.1.5**는 xUnit v1/v2/v3 모두 지원합니다. xUnit v3는 완전한 재설계로 Microsoft Testing Platform 기반 self-executing 테스트 어셈블리를 생성합니다. 현 시점에서는 **xunit 2.9.3** 유지를 권장하며, v3 마이그레이션은 신규 프로젝트에서 검토하세요.

---

## EF Core 9.0 Breaking Changes

EF Core 9.0에서 `Migrate()` 또는 `MigrateAsync()` 호출 시 **보류 중인 모델 변경**이 있으면 예외가 발생합니다. 다음 코드로 경고를 억제할 수 있습니다:

```csharp
optionsBuilder.ConfigureWarnings(w => 
    w.Ignore(RelationalEventId.PendingModelChangesWarning));
```

---

## WPF + .NET 9.0 새 기능

.NET 9.0 WPF에서 **Fluent 테마**와 **ThemeMode 속성**이 추가되었습니다. Windows 11 스타일링과 라이트/다크 모드 지원이 가능합니다:

```xml
<Application.Resources>
  <ResourceDictionary>
    <ResourceDictionary.MergedDictionaries>
      <ResourceDictionary Source="pack://application:,,,/PresentationFramework.Fluent;component/Themes/Fluent.xaml" />
    </ResourceDictionary.MergedDictionaries>
  </ResourceDictionary>
</Application.Resources>
```

**주의:** .NET 9.0에서 `BinaryFormatter`가 제거되어 `PlatformNotSupportedException`이 발생할 수 있습니다. 클립보드 및 드래그-드롭 작업에 영향을 미칠 수 있습니다.

---

## 권장 패키지 구성

```xml
<ItemGroup>
  <!-- GIS -->
  <PackageReference Include="MaxRev.Gdal.Core" Version="3.12.0.423" />
  <PackageReference Include="MaxRev.Gdal.WindowsRuntime.Minimal" Version="3.12.0.397" />
  <PackageReference Include="NetTopologySuite" Version="2.6.0" />
  <PackageReference Include="NetTopologySuite.IO.GeoJSON" Version="4.0.0" />
  
  <!-- Database -->
  <PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" Version="9.0.10" />
  <PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite" Version="9.0.10" />
  
  <!-- DI / Hosting -->
  <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="9.0.10" />
  <PackageReference Include="Microsoft.Extensions.Hosting" Version="9.0.10" />
  <PackageReference Include="Microsoft.Extensions.Logging" Version="9.0.10" />
  <PackageReference Include="Microsoft.Extensions.Logging.Console" Version="9.0.9" />
  <PackageReference Include="Microsoft.Extensions.Http" Version="9.0.4" />
  
  <!-- Logging -->
  <PackageReference Include="Serilog" Version="4.3.0" />
  <PackageReference Include="Serilog.Extensions.Logging" Version="9.0.0" />
  
  <!-- WPF / UI -->
  <PackageReference Include="CommunityToolkit.Mvvm" Version="8.4.0" />
  <PackageReference Include="Microsoft.Xaml.Behaviors.Wpf" Version="1.1.135" />
  
  <!-- PDF / CSV -->
  <PackageReference Include="iTextSharp.LGPLv2.Core" Version="3.7.12" />
  <PackageReference Include="PDFsharp-MigraDoc-WPF" Version="6.2.3" />
  <PackageReference Include="CsvHelper" Version="33.1.0" />
  
  <!-- gRPC -->
  <PackageReference Include="Grpc.Net.Client" Version="2.71.0" />
  <PackageReference Include="Google.Protobuf" Version="3.33.1" />
  <PackageReference Include="Grpc.Tools" Version="2.72.0" PrivateAssets="all" />
  
  <!-- Testing -->
  <PackageReference Include="xunit" Version="2.9.3" />
  <PackageReference Include="xunit.runner.visualstudio" Version="3.1.5" PrivateAssets="all" />
  <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.14.1" />
  <PackageReference Include="Moq" Version="4.20.72" />
  <PackageReference Include="coverlet.collector" Version="6.0.4" PrivateAssets="all" />
</ItemGroup>
```

---

## 결론

SpatialCheckPro2 프로젝트의 모든 패키지가 .NET 9.0과 호환되며, **총 18개 패키지에서 업데이트가 가능**합니다. 가장 중요한 업데이트는 GDAL 3.12.0 (새 드라이버 지원), Microsoft.Extensions.Http 9.0.4 (버전 정합성), gRPC 2.71.0+ (성능 개선)입니다. iTextSharp.LGPLv2.Core 업그레이드 시 SkiaSharp 의존성 전환에 따른 테스트가 필수이며, EF Core Spatial과 NetTopologySuite 간 호환성은 완벽히 유지됩니다. 패키지 업데이트 후 전체 테스트 스위트 실행과 GIS 기능 검증을 권장합니다.